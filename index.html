<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>FinTrack</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Google Fonts -->
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=DM+Sans:wght@400;500;600&display=swap"
    rel="stylesheet">


  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <style>
    body {
      font-family: 'DM Sans', sans-serif;
      background: #0B1426;
      color: #F9FAFB;
      margin: 0;
    }

    .chart-container {
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
      margin-top: 2rem;
    }

    .chart-box {
      flex: 1;
      min-width: 300px;
      background: #111C36;
      padding: 1rem;
      border-radius: 1rem;
      height: 400px;
    }

    .navbar {
      display: flex;
      justify-content: space-between;
      padding: 1rem 2rem;
      background: #111C36;
      position: sticky;
      top: 0;
      z-index: 1000;
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
    }

    /* Add Button */
    .add-btn {
      background: linear-gradient(135deg, #10B981, #059669);
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 2px;
      font-weight: 600;
      color: #F9FAFB;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .add-btn:hover {
      transform: translateY(-3px);
    }

    .add-btn:active {
      transform: scale(0.95);
    }

    /* Split Button */
    .split-btn {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      border: none;
      padding: 0.7rem 1.5rem;
      border-radius: 2px;
      font-weight: 600;
      color: #F9FAFB;
      cursor: pointer;
      transition: all 0.3s ease;
      display: none;
    }

    .split-btn:hover {
      transform: translateY(-3px);
    }

    .split-btn.visible {
      display: inline-block;
    }

    /* Split Row */
    .split-row {
      display: none;
      width: 100%;
      justify-content: center;
      align-items: center;
      gap: 0.8rem;
      margin-top: 0.5rem;
      animation: fadeIn 0.3s ease;
    }

    .split-row.visible {
      display: flex;
    }

    .split-row input {
      width: 80px;
      padding: 0.6rem 0.8rem;
      border-radius: 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: #0B1426;
      color: #F9FAFB;
      font-size: 1rem;
      text-align: center;
      outline: none;
    }

    .split-row input:focus {
      border-color: #3B82F6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
    }

    .split-row span {
      color: #94a3b8;
      font-size: 0.9rem;
    }

    .split-confirm-btn {
      background: linear-gradient(135deg, #3B82F6, #2563EB);
      border: none;
      padding: 0.5rem 1.2rem;
      border-radius: 2px;
      font-weight: 600;
      color: #F9FAFB;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .split-cancel-btn {
      background: #334155;
      border: none;
      padding: 0.5rem 1rem;
      border-radius: 2px;
      font-weight: 500;
      color: #94a3b8;
      cursor: pointer;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-5px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .logo {
      font-family: 'Playfair Display', serif;
      font-size: 1.7rem;
      color: #10B981;
      font-weight: 700;
    }

    .nav-links a {
      margin-right: 1rem;
      cursor: pointer;
      color: #64748B;
    }

    .nav-links a.active {
      color: #10B981;
    }

    .main-content {
      padding: 2rem;
      max-width: 1300px;
      margin: auto;
    }

    .summary-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .summary-card {
      background: #111C36;
      backdrop-filter: blur(12px);
      padding: 1.5rem;
      border-radius: 1rem;
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .summary-card:hover {
      transform: translateY(-5px);
    }


    .summary-card h3 {
      margin: 0;
      font-size: 0.9rem;
      color: #64748B;
    }

    .amount {
      font-size: 2.2rem;
      font-family: 'Playfair Display', serif;
      margin-top: 0.5rem;
    }

    canvas {
      max-width: 100%;
    }

    .summary-card:nth-child(1) {
      border-left: 4px solid #10B981;
    }

    .summary-card:nth-child(2) {
      border-left: 4px solid #EF4444;
    }

    .summary-card:nth-child(3) {
      border-left: 4px solid #3B82F6;
    }

    /* Transaction Box Container */
    .transaction-box {
      max-width: 700px;
      margin: 3rem auto;
      padding: 2rem;
      background: #111C36;
      backdrop-filter: blur(12px);
      border-radius: 1rem;
      border: 1px solid rgba(255, 255, 255, 0.05);
      text-align: center;
    }

    /* Horizontal Form Layout */
    .transaction-form {
      display: flex;
      gap: 1rem;
      justify-content: center;
      flex-wrap: wrap;
      margin-top: 1.5rem;
      align-items: flex-start;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }

    .error-msg {
      color: #EF4444;
      font-size: 1rem;
      font-weight: bold;
      margin-top: 0.25rem;
      min-height: 1.2em;
      margin-left: 0.5rem;
    }

    /* Input & Select Styling */
    .transaction-form input,
    .transaction-form select {
      padding: 0.8rem 1rem;
      border-radius: 0.8rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: #0B1426;
      color: #F9FAFB;
      font-size: 1rem;
      outline: none;
      transition: 0.3s ease;
      min-width: 180px;
    }

    .transaction-form .note-input {
      display: none;
      min-width: 200px;
    }

    .transaction-form .note-input.visible {
      display: block;
    }

    /* Focus Effect */
    .transaction-form input:focus,
    .transaction-form select:focus {
      border-color: #10B981;
      box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }
  </style>
</head>

<body>

  <!-- NAVBAR -->
  <nav class="navbar">
    <div class="logo">FinTrack</div>
    <div class="nav-links">
      <a class="active" onclick="showPage('dashboard')">Dashboard</a>
      <a onclick="showPage('transactions')">Transactions</a>
      <a onclick="showPage('profile')">Profile</a>
    </div>
  </nav>

  <!-- MAIN -->
  <main class="main-content">

    <!-- DASHBOARD -->
    <section id="dashboard">
      <h1>Welcome back, GT EditsðŸ‘‹</h1>

      <div class="summary-cards">
        <div class="summary-card">
          <h3>Total Income</h3>
          <div class="amount" id="income">â‚¹0</div>
        </div>

        <div class="summary-card">
          <h3>Total Expenses</h3>
          <div class="amount" id="expenses">â‚¹0</div>
        </div>

        <div class="summary-card">
          <h3>Balance</h3>
          <div class="amount" id="balance">â‚¹0</div>
        </div>
      </div>


      <div class="chart-container">
        <div class="chart-box">
          <canvas id="pieChart"></canvas>
        </div>
        <div class="chart-box">
          <canvas id="barChart"></canvas>
        </div>
      </div>

    </section>

    <!-- TRANSACTIONS -->
    <section id="transactions" style="display:none">
      <div class="transaction-box">
        <h2>Add Transaction</h2>

        <div class="transaction-form">
          <div class="input-group">
            <input id="amount" type="number" placeholder="Enter Amount" min="0.01" step="0.01"
              oninput="document.getElementById('amount-error').innerText = ''">
            <span id="amount-error" class="error-msg"></span>
          </div>

          <select id="category" onchange="onCategoryChange()">
            <optgroup label="Expense">
              <option value="Food">Food</option>
              <option value="Housing / Rent">Housing / Rent</option>
              <option value="Utilities">Utilities</option>
              <option value="Transport">Transport</option>
              <option value="EMI">EMI</option>
              <option value="Insurance">Insurance</option>
              <option value="Shopping">Shopping</option>
              <option value="Entertainment">Entertainment</option>
              <option value="Health / Medical">Health / Medical</option>
              <option value="Investments">Investments</option>
              <option value="Travel">Travel</option>
              <option value="Gifts / Donations">Gifts / Donations</option>
              <option value="Miscellaneous">Miscellaneous</option>
            </optgroup>
            <optgroup label="Income">
              <option value="Salary">Salary</option>
              <option value="Freelance">Freelance</option>
              <option value="Investment Return">Investment Return</option>
              <option value="Other">Other</option>
            </optgroup>
          </select>

          <input id="note" type="text" class="note-input" placeholder="Add a note...">

          <button class="add-btn" onclick="addTransaction()">
            + Add
          </button>
          <button class="split-btn" id="splitBtn" onclick="toggleSplitRow()">
            âœ‚ Split
          </button>
        </div>

        <div class="split-row" id="splitRow">
          <span>Split among</span>
          <input id="splitCount" type="number" min="2" value="2" placeholder="2">
          <span>people</span>
          <button class="split-confirm-btn" onclick="addSplitTransaction()">Confirm Split</button>
          <button class="split-cancel-btn" onclick="toggleSplitRow()">Cancel</button>
        </div>

      </div>

      <ul id="txList"></ul>
    </section>

    <!-- PROFILE -->
    <section id="profile" style="display:none">
      <h2>Profile</h2>
      <p>Name: Tanishq Mehta</p>
      <p>Occupation : Student</p>
      <p>Email: tanishqmehta08@gmail.com</p>
      <p>Socials : <a href="https://github.com/gt228-tan" style="color: rgb(141, 151, 255); text-decoration: none;">GitHub </a> | <a href="https://www.linkedin.com/in/tanishq-mehta-51055127b/" style="color: rgb(141, 151, 255); text-decoration: none;">LinkedIn</a></p>
      <p>------------------------------</p>
      <p>Name: Dhairya Shah</p>
      <p>Occupation : Student</p>
      <p>Email: dhairya.shah13@gmail.com</p>
      <p>Socials : <a href="https://github.com/dhairya-shah13" style="color: rgb(141, 151, 255); text-decoration: none;">GitHub </a> | <a href="https://www.linkedin.com/in/dhairya-shah-42703a319/" style="color: rgb(141, 151, 255); text-decoration: none;">LinkedIn</a></p>
    </section>

  </main>

  <script>
    lucide.createIcons();

    const API_URL = "/transactions";
    let transactions = [];

    /* ---------- CATEGORY CONFIG ---------- */
    const incomeCategories = ["Salary", "Freelance", "Investment Return", "Other"];

    // Color map for each category
    const categoryColors = {
      // Expenses
      "Food": "#EF4444",
      "Housing / Rent": "#F97316",
      "Utilities": "#F59E0B",
      "Transport": "#EAB308",
      "EMI": "#84CC16",
      "Insurance": "#22C55E",
      "Shopping": "#14B8A6",
      "Entertainment": "#06B6D4",
      "Health / Medical": "#0EA5E9",
      "Investments": "#3B82F6",
      "Travel": "#6366F1",
      "Gifts / Donations": "#8B5CF6",
      "Miscellaneous": "#A855F7",
      // Income
      "Salary": "#10B981",
      "Freelance": "#34D399",
      "Investment Return": "#6EE7B7",
      "Other": "#A7F3D0"
    };

    function isIncome(category) {
      return incomeCategories.includes(category);
    }

    /* ---------- NOTE INPUT & SPLIT TOGGLE ---------- */
    function onCategoryChange() {
      const cat = document.getElementById("category").value;
      const noteInput = document.getElementById("note");
      const splitBtn = document.getElementById("splitBtn");
      const splitRow = document.getElementById("splitRow");

      // Note input toggle
      if (cat === "Miscellaneous" || cat === "Other") {
        noteInput.classList.add("visible");
        noteInput.placeholder = cat === "Miscellaneous" ? "Describe the expense..." : "Describe the income...";
      } else {
        noteInput.classList.remove("visible");
        noteInput.value = "";
      }

      // Split button: show only for expense categories
      if (!isIncome(cat)) {
        splitBtn.classList.add("visible");
      } else {
        splitBtn.classList.remove("visible");
        splitRow.classList.remove("visible");
      }
    }

    // Initialize on load
    onCategoryChange();

    function toggleSplitRow() {
      const splitRow = document.getElementById("splitRow");
      splitRow.classList.toggle("visible");
    }

    async function addSplitTransaction() {
      const amountVal = document.getElementById("amount").value;
      const category = document.getElementById("category").value;
      const note = document.getElementById("note").value.trim();
      const splitCount = parseInt(document.getElementById("splitCount").value);
      const amountError = document.getElementById("amount-error");
      amountError.innerText = "";

      if (!amountVal) {
        amountError.innerText = "Please enter an amount";
        return;
      }
      const totalAmount = Number(amountVal);
      if (totalAmount <= 0) {
        amountError.innerText = "Values cannot be negative";
        return;
      }
      if (!splitCount || splitCount < 2) {
        amountError.innerText = "Split must be among at least 2 people";
        return;
      }

      const userShare = Math.round((totalAmount / splitCount) * 100) / 100;
      const splitNote = note ? `${note} (Split ${splitCount} ways)` : `Split ${splitCount} ways`;

      try {
        const payload = { amount: userShare, category, note: splitNote };
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          document.getElementById("amount").value = "";
          document.getElementById("note").value = "";
          document.getElementById("note").classList.remove("visible");
          document.getElementById("splitRow").classList.remove("visible");
          document.getElementById("splitCount").value = "2";
          document.getElementById("category").value = "Food";
          onCategoryChange();
          fetchTransactions();
        } else {
          amountError.innerText = "Failed to save";
        }
      } catch (err) {
        console.error("Error adding split transaction:", err);
        amountError.innerText = "Backend error";
      }
    }

    /* ---------- PAGE SWITCH ---------- */
    function showPage(page) {
      document.querySelectorAll("section").forEach(s => s.style.display = "none");
      document.getElementById(page).style.display = "block";

      document.querySelectorAll(".nav-links a").forEach(a => a.classList.remove("active"));
      event.target.classList.add("active");
    }

    /* ---------- API INTERACTIONS ---------- */
    async function fetchTransactions() {
      try {
        const res = await fetch(API_URL);
        if (!res.ok) throw new Error("Failed to fetch");
        transactions = await res.json();
        calculate();
      } catch (err) {
        console.error("Error loading transactions:", err);
      }
    }

    async function addTransaction() {
      const amountVal = document.getElementById("amount").value;
      const category = document.getElementById("category").value;
      const note = document.getElementById("note").value.trim();

      const amountError = document.getElementById("amount-error");
      amountError.innerText = "";

      if (!amountVal) {
        amountError.innerText = "Please enter an amount";
        return;
      }
      const amount = Number(amountVal);

      if (amount <= 0) {
        amountError.innerText = "Values cannot be negative";
        return;
      }

      try {
        const payload = { amount, category };
        if (note) payload.note = note;

        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        if (res.ok) {
          document.getElementById("amount").value = "";
          document.getElementById("note").value = "";
          document.getElementById("note").classList.remove("visible");
          document.getElementById("category").value = "Food";
          fetchTransactions();
        } else {
          amountError.innerText = "Failed to save";
        }
      } catch (err) {
        console.error("Error adding transaction:", err);
        amountError.innerText = "Backend error";
      }
    }

    /* ---------- CALCULATIONS ---------- */
    function calculate() {
      let income = 0, expense = 0;
      const catTotals = {}; // { "Food": 100, "Salary": 5000 }

      transactions.forEach(t => {
        const amt = Number(t.amount);
        const cat = t.category || "Miscellaneous";

        if (isIncome(cat)) {
          income += amt;
        } else {
          expense += amt;
        }

        if (!catTotals[cat]) catTotals[cat] = 0;
        catTotals[cat] += amt;
      });

      document.getElementById("income").innerText = "\u20B9" + income;
      document.getElementById("expenses").innerText = "\u20B9" + expense;
      document.getElementById("balance").innerText = "\u20B9" + (income - expense);

      renderCharts(income, expense, catTotals);
      renderTransactions();
    }

    /* ---------- CHARTS ---------- */
    let pieChart, barChart;

    function renderCharts(income, expense, catTotals) {
      if (pieChart) pieChart.destroy();
      if (barChart) barChart.destroy();

      // Pie Chart: All categories breakdown
      const pieLabels = Object.keys(catTotals);
      const pieData = Object.values(catTotals);
      const pieColors = pieLabels.map(c => categoryColors[c] || "#64748B");

      pieChart = new Chart(document.getElementById("pieChart"), {
        type: "pie",
        data: {
          labels: pieLabels.length ? pieLabels : ["No Data"],
          datasets: [{
            data: pieData.length ? pieData : [1],
            backgroundColor: pieLabels.length ? pieColors : ["#334155"],
            borderWidth: 0
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'right',
              labels: {
                color: '#F9FAFB',
                padding: 12,
                font: { size: 11 }
              }
            }
          }
        }
      });

      // Bar Chart: Income vs Expense totals
      barChart = new Chart(document.getElementById("barChart"), {
        type: "bar",
        data: {
          labels: ["Income", "Expense"],
          datasets: [{
            label: 'Amount',
            data: [income, expense],
            backgroundColor: ["#10B981", "#EF4444"],
            borderWidth: 0,
            borderRadius: 6
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(255, 255, 255, 0.1)' },
              ticks: { color: '#64748B' }
            },
            x: {
              grid: { display: false },
              ticks: { color: '#64748B' }
            }
          },
          plugins: {
            legend: { display: false }
          }
        }
      });
    }

    /* ---------- TRANSACTIONS RENDER ---------- */
    function renderTransactions() {
      const list = document.getElementById("txList");
      list.innerHTML = "";
      transactions.forEach(t => {
        const li = document.createElement("li");
        li.style.background = "#111C36";
        li.style.padding = "0.8rem 1rem";
        li.style.marginBottom = "0.7rem";
        li.style.borderRadius = "0.8rem";
        li.style.display = "flex";
        li.style.justifyContent = "space-between";
        li.style.alignItems = "center";
        li.style.boxShadow = "0 6px 15px rgba(0,0,0,0.3)";

        const cat = t.category || "Miscellaneous";
        const type = isIncome(cat) ? "INCOME" : "EXPENSE";
        const color = categoryColors[cat] || "#64748B";

        const leftSpan = document.createElement("span");
        leftSpan.innerHTML = `
          <span style="color:${isIncome(cat) ? '#10B981' : '#EF4444'}; font-weight:bold">${type}</span>
          <span style="margin-left:0.5rem; color:${color}; font-weight:600">${cat}</span>
          ${t.note ? `<span style="font-size:0.8rem; color:#94a3b8; margin-left:0.5rem">(${t.note})</span>` : ''}
        `;

        const amtSpan = document.createElement("span");
        amtSpan.style.fontWeight = "600";
        amtSpan.style.color = isIncome(cat) ? "#10B981" : "#EF4444";
        amtSpan.innerText = `\u20B9${t.amount}`;

        li.appendChild(leftSpan);
        li.appendChild(amtSpan);
        list.appendChild(li);
      });
    }

    // Initial Fetch
    fetchTransactions();
  </script>

</body>

</html>